---
title: "matrices, clustering, and heatmaps assignment"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**This assignment is due Thursday December 15 at 5pm**

```{r load-packages}
library(tidyverse)
library(pheatmap)
library(viridis)
library(MetBrewer)
library(here)
```

We will be using all of the same files you already downloaded for class. In case you don't have them, you can run the script to download them(found [here]()). You should put this script in the same folder as your rmarkdown. If you already have these files, you don't need to run this script.

```{r, eval = FALSE}
# conditionally download all of the files used in rmarkdown from github 
source("download_files.R")
```

Then load in packages


1 (2 pts). Explore the female names matrix.

A) How many girls named Olivia were born in Maryland?
B) How many total girls were included in the data from Maine? *Hint use `colSums` followed by indexing*
C ) How many girls name Isabella were included in the full dataset? *Hint use `rowSums` followed by indexing*
D) What is the most popular girls name? *Hint use `rowSums` followed by `which.max`*

Most popular girls name (most individuals total, regardless of state)

```{r}
# Load in data
female_names_mat <- read.csv(here("class_7-9_data", "girl_name_counts.csv"),
                             row.names = 1) %>%
  as.matrix()
```

```{r}
female_names_mat["Olivia", "Maryland"]
```

There were 284 girls named Olivia in the Maryland database


```{r}
colSums(female_names_mat)["Maine"]
```

There were 967 girls from Maine included in the database

```{r}
rowSums(female_names_mat)["Isabella"]
```

There were 5514 girls named Isabella included in the database

```{r}
which.max(rowSums(female_names_mat))
```

Olivia is the most popular girls name

2 (2 pts). Normalize the female names *Hint divide each value by the total values for the state like we did in the matrices exercise for the male names. Remember to transpose the matrix to divide by colSums*

```{r}
normalized_mat <- t(t(female_names_mat) / colSums(female_names_mat))
```

3 (2 pts). Cluster the female names with k means into 4 gropus, report the cluster for each name. You can just report the clusters by printing the result in the `cluster` slot of the output from `kmeans`

```{r}
km.res <- kmeans(normalized_mat, centers = 4, nstart = 25)

print(km.res$cluster)
```

4 (2 pts). Repeat with 4 clusters using `hclust`, report cluster for each name. You can just print the output of `cutree`. Were the clusters the same?

```{r}
hc <- hclust(dist(normalized_mat))

hc_clusters <- cutree(tree = hc, k =4)

print(hc_clusters)
```

No, the clusters were not the same between the two groups.

5 (2 pts). Make a heatmap of the female names only. Remember to first scale the data. Annotate the states using the `state_info.csv` file. Use any coloring palettes you want (not the defaults). Cluster and separate to the number of clusters you feel best fits the data.
```{r, fig.height = 4}
# Load in states data
state_info <- read.csv(here("class_7-9_data", "state_info.csv"), row.names = 1)

scaled_mat <- scale(female_names_mat, scale = TRUE, center = TRUE)

location_colors <- met.brewer("Pissaro",
                              n = length(unique(state_info$Location))) %>%
  as.character()

names(location_colors) <- unique(state_info$Location)

size_colors <- met.brewer("Navajo",
                          n = length(unique(state_info$Size))) %>%
  as.character()

names(size_colors) <- unique(state_info$Size)

density_colors <- met.brewer("Juarez",
                             n = length(levels(state_info$Density))) %>%
  as.character()

names(density_colors) <- levels(state_info$Density)

all_colors <- list("Location" = location_colors,
                   "Size" = size_colors,
                   "Density" = density_colors)

blueYellow <- c("#352A86", "#343DAE", "#0262E0", "#1389D2", "#2DB7A3",
                  "#A5BE6A", "#F8BA43", "#F6DA23", "#F8FA0D")

pheatmap(scaled_mat,
         color = blueYellow,
         annotation_col = state_info,
         annotation_colors = all_colors,
         cutree_rows = 2,
         cutree_cols = 3)
```
